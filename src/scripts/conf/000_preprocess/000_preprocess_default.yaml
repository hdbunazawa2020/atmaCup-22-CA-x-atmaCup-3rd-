exp: 000_prepeocess_ver03  # TODO: 毎回、実験の連番を変える
seed: 1129
debug: false
author: hidebu
competition: atmacup22

# パス設定（Hydra が cwd を変えるので基本は絶対パス推奨）
data_dir: /mnt/nfs/home/hidebu/study/atmaCup-22-CA-x-atmaCup-3rd/data/raw
image_dir: /mnt/nfs/home/hidebu/study/atmaCup-22-CA-x-atmaCup-3rd/data/raw/images

# train の事前 crop 出力先（root まで）
crop_dir: /mnt/nfs/home/hidebu/study/atmaCup-22-CA-x-atmaCup-3rd/data/processed/crops
output_dir: /mnt/nfs/home/hidebu/study/atmaCup-22-CA-x-atmaCup-3rd/data/processed

# use_crops は「train の事前 crop を作るか」
# test は rel_path の crop が配布されるため、このフラグとは独立に常に crop を使う
use_crops: true
padding_ratio: 0.1

# ============================
# (NEW) train crop を test に寄せる: 足元/下側crop追加
# ============================
add_bottom_crops: true
bottom_crop_apply_angles: ["top", "side"]  # "top"もやるなら ["top","side"]
bottom_crop_jpeg_quality: 95

# keep 40-70% from bottom (partial) -> まずは正例扱い候補
bottom_partial_prob: 0.2
bottom_partial_keep_min: 0.4
bottom_partial_keep_max: 0.7

# keep 10-25% from bottom (extreme) -> unknown/junk候補（is_junk=1で出す）
bottom_extreme_prob: 0.05
bottom_extreme_keep_min: 0.1
bottom_extreme_keep_max: 0.25

# crop増殖を formation_aug にも掛けるか（デフォOFF推奨：データが膨れる）
bottom_crop_apply_to_all_formation: false

# ============================
# (NEW) train の n_players を test に寄せる: formation aug
# ============================
formation_aug_enable: true
formation_aug_prob: 0.5  # 各frameに対して、baseに加えて1回だけaugを追加する確率

# target_n をどこから取るか: uniform / from_test
formation_aug_target_n_mode: from_test
formation_aug_target_n_min: 8
formation_aug_target_n_max: 14

# target_n > n のときに足す dummy点のゆらぎ
formation_dummy_jitter_std: 0.01
formation_dummy_jitter_clip: 0.05

# ============================
# (NEW) no-player / background crops (train only)
# ============================
add_bg_crops: true
bg_apply_angles: ["top", "side"]

# 1フレーム(=quarter/session/frame/angle)あたり何個作るか
bg_per_frame: 1

# ★ padding後crop領域の max IoU がこの値以下なら採用
# 0.0 にすると「完全に非交差」を強制できる（no-player寄り）
bg_iou_thr: 0.0
bg_max_trials: 80

# bbox サイズは GT の (w,h) をサンプルしてスケール jitter
bg_wh_scale_min: 0.8
bg_wh_scale_max: 1.2
bg_min_wh: 16

# train では使わない（label_id=-1 だから） → is_junk=1 を推奨
bg_mark_as_junk: true
bg_crop_variant: "bg_random"

# ============================
# (NEW) crop resize (train/test)
# ============================
crop_output_size: 384   # null なら従来通り
crop_interp: area       # area / linear / cubic
crop_jpeg_quality: 95